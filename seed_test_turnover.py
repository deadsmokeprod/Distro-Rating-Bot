from __future__ import annotations

import sqlite3
from datetime import datetime


ROWS = [
    (
        "01.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(022)ТМ "MJOLNIR" Медовуха облепиховая"Огненный Великан Сурт" барная версия 0.5л',
        "3,000",
        "",
        "4611012110",
        "ИП АЛЕКСЕЕВА ОЛЬГА ВАЛЕРЬЕВНА",
        "772094106945",
        "ИП АЛЕКСЕЕВ МАКСИМ СЕРГЕЕВИЧ",
    ),
    (
        "01.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(105) Медовуха пихта-манго "Хель Владычица" Барная версия 0.5л',
        "1,500",
        "",
        "4611012110",
        "ИП АЛЕКСЕЕВА ОЛЬГА ВАЛЕРЬЕВНА",
        "772094106945",
        "ИП АЛЕКСЕЕВ МАКСИМ СЕРГЕЕВИЧ",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(001) Медовуха "Классическая" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "745901731578",
        "ИП БОГДАНОВА ЛЯЙСАН АЛИКОВНА",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(001) Медовуха "Классическая" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "663231694050",
        "ИП СУСЛОВ ПАВЕЛ ВЛАДИМИРОВИЧ",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(001) Медовуха "Классическая" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "667208037550",
        "ИП ОСТАФЬЕВ МИХАИЛ ЮРЬЕВИЧ",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(001) Медовуха "Классическая" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "668606316330",
        "ИП ПАСАЖЕННИКОВА МАРИНА АНАТОЛЬЕВНА",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(001) Медовуха "Классическая" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "667351769949",
        "ИП КОЛБИН АЛЕКСАНДР ВАДИМОВИЧ",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(001) Медовуха "Классическая" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "661002837785",
        "ИП МЕЛЬНИК ЕЛЕНА АЛЕКСАНДРОВНА",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(001) Медовуха "Классическая" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "667000337308",
        "ИП ШАШМУРИНА ОЛЬГА ГРИГОРЬЕВНА",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(102)ТМ "MJOLNIR" Сидр фруктовый яблочный "Бессмертие Идунн" Барная версия 0.5л',
        "0,500",
        "",
        "4611012110",
        "ИП КОРОЛЁВ ИЛЬЯ АНДРЕЕВИЧ",
        "3662162993",
        'ООО "ОЛИМП"',
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(104)ТМ "MJOLNIR" Сидр фруктовый грушевый "Проделки Локи" Барная версия 0.5л',
        "0,500",
        "",
        "4611012110",
        "ИП КОРОЛЁВ ИЛЬЯ АНДРЕЕВИЧ",
        "3662162993",
        'ООО "ОЛИМП"',
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(062) Медовуха "Мид вайн" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "025610179664",
        "ИП ТОКАРЕВА ЕВГЕНИЯ АНАТОЛЬЕВНА",
    ),
    (
        "02.01.2026 0:00:00",
        "Передача между УОТ",
        'бут(062) Медовуха "Мид вайн" пастеризованная нефильтрованная неосветленная натуральная 0.5',
        "6,000",
        "",
        "4611012110",
        "ЛЕТОС ООО",
        "450140044339",
        "ИП КУЗНЕЦОВА ОКСАНА ЛЕОНИДОВНА",
    ),
]


def to_iso(dt_str: str) -> str:
    return datetime.strptime(dt_str, "%d.%m.%Y %H:%M:%S").date().isoformat()


def to_float(val: str) -> float:
    if not val:
        return 0.0
    return float(val.replace(" ", "").replace(",", "."))


def main() -> None:
    conn = sqlite3.connect("./data/bot.sqlite3")
    cur = conn.cursor()
    cur.executemany(
        """
        INSERT INTO chz_turnover (
            period, type_operation, nomenclature, volume_goods, volume_partial,
            seller_inn, seller_name, buyer_inn, buyer_name, updated_at
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))
        ON CONFLICT(
            period, type_operation, nomenclature, seller_inn, seller_name, buyer_inn, buyer_name
        ) DO UPDATE SET
            volume_goods=excluded.volume_goods,
            volume_partial=excluded.volume_partial,
            updated_at=excluded.updated_at
        """,
        [
            (
                to_iso(r[0]),
                r[1],
                r[2],
                to_float(r[3]),
                to_float(r[4]),
                r[5],
                r[6],
                r[7],
                r[8],
            )
            for r in ROWS
        ],
    )
    conn.commit()
    conn.close()
    print(f"Inserted/updated {len(ROWS)} rows")


if __name__ == "__main__":
    main()
